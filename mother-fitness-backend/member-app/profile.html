<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6c5ce7">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Profile Settings - Mother Fitness</title>
    <link rel="stylesheet" href="./styles.css?v=6.2.1">
</head>

<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <a href="./dashboard.html" class="btn-back">‚Üê</a>
                <h1>Profile Settings</h1>
            </div>
        </header>

        <main class="app-main">
            <!-- Profile Photo Display (Read-Only) -->
            <div class="profile-section fade-in">
                <h3>üì∏ Profile Photo</h3>
                <div class="photo-display-container">
                    <div class="photo-preview" id="photoPreview">
                        <div class="photo-placeholder">üë§</div>
                    </div>
                </div>
            </div>

            <!-- App Settings -->
            <div class="profile-section fade-in" style="animation-delay: 0.05s;">
                <h3>‚öôÔ∏è App Settings</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                    <div>
                        <span style="font-weight: 600;">Dark Mode</span>
                        <p style="font-size: 0.85rem; color: var(--text-secondary);">Switch between light and dark
                            themes</p>
                    </div>
                    <button id="profileThemeToggle" class="btn-primary" style="width: auto; padding: 8px 16px;">
                        üåô Toggle
                    </button>
                </div>
            </div>

            <!-- Personal Information -->
            <div class="profile-section fade-in" style="animation-delay: 0.1s;">
                <h3>Personal Information</h3>
                <form id="profileForm">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="name" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="phone" required>
                    </div>
                    <button type="submit" class="btn-primary">Update Profile</button>
                </form>
            </div>

            <!-- Change Password -->
            <div class="profile-section fade-in" style="animation-delay: 0.2s;">
                <h3>Change Password</h3>
                <form id="passwordForm">
                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password" id="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="newPassword" minlength="4" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <input type="password" id="confirmPassword" minlength="4" required>
                    </div>
                    <button type="submit" class="btn-primary">Change Password</button>
                </form>
            </div>

            <!-- Logout -->
            <div class="profile-section fade-in" style="animation-delay: 0.3s;">
                <button id="logoutBtn" class="btn-danger">Logout</button>
            </div>
        </main>
    </div>

    <script src="./config.js?v=6.2.1"></script>
    <script src="./api.js?v=6.2.1"></script>
    <script src="./theme.js?v=6.2.1"></script>
    <script>
        const api = new MemberAPI();
        if (!api.token) window.location.href = './index.html';

        let currentProfile = null;

        async function loadProfile() {
            const response = await api.getProfile();
            currentProfile = response.data.customer;

            // Load basic info
            document.getElementById('name').value = currentProfile.name;
            document.getElementById('email').value = currentProfile.email;
            document.getElementById('phone').value = currentProfile.phone;

            // Display photo (read-only)
            const photoPreview = document.getElementById('photoPreview');
            if (currentProfile.photo) {
                photoPreview.innerHTML = `<img src="${currentProfile.photo}" alt="Profile Photo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                photoPreview.innerHTML = '<div class="photo-placeholder">üë§</div>';
            }
        }

        // Profile form (without photo)
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await api.updateProfile({
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                });
                alert('Profile updated successfully!');
                await loadProfile();
            } catch (error) {
                alert('Failed to update profile: ' + error.message);
            }
        });

        // Password form
        document.getElementById('passwordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const newPwd = document.getElementById('newPassword').value;
            const confirmPwd = document.getElementById('confirmPassword').value;

            if (newPwd !== confirmPwd) {
                alert('Passwords do not match!');
                return;
            }

            try {
                await api.changePassword(
                    document.getElementById('currentPassword').value,
                    newPwd
                );
                alert('Password changed successfully!');
                e.target.reset();
            } catch (error) {
                alert('Failed to change password: ' + error.message);
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                api.clearToken();
                window.location.href = './index.html';
            }
        });

        loadProfile();

        // Theme Toggle Logic for Profile Page
        const profileThemeBtn = document.getElementById('profileThemeToggle');
        if (profileThemeBtn) {
            // Set initial state
            const currentTheme = localStorage.getItem('theme') || 'light';
            profileThemeBtn.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';

            profileThemeBtn.addEventListener('click', () => {
                const body = document.body;
                const isDark = body.classList.contains('dark-mode');

                if (isDark) {
                    window.updateTheme('light');
                    profileThemeBtn.textContent = 'üåô Dark Mode';
                } else {
                    window.updateTheme('dark');
                    profileThemeBtn.textContent = '‚òÄÔ∏è Light Mode';
                }
            });
        }
    </script>
</body>

</html>